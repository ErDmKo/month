(()=>{var m=(a,b)=>(...c)=>b.apply(null,a.concat(c)),E=(a,b)=>m([a],b),Q=(a,b)=>{const c=a.document.createElement("canvas");a.Object.assign(c.style,{position:"absolute",top:"0px",left:"0px",pointerEvents:"none",width:"100%",height:"100%"});a.Object.assign(b.style,{position:"relative"});b.appendChild(c);b=c.getBoundingClientRect();b=a.Object.assign(b,{width:2*b.width,height:2*b.height});a.Object.assign(c,{width:b.width,height:b.height});return[b,c]},y=a=>b=>b(a),F=(a=[])=>y(a),G=(a,b)=>{b.push(a)},
z=(a,b)=>{for(const c of b)c(a)},H=[[[[0,1,0],[1,1,1]],"#808001"],[[[1,1,0],[0,1,1]],"#008000"],[[[0,1,1],[1,1,0]],"#018080"],[[[1,0],[1,0],[1,1]],"#888"],[[[0,1],[0,1],[1,1]],"#008"],[[[1],[1],[1],[1]],"#800"],[[[1,1],[1,1]],"#808"]],w=(a,b)=>{a=a.length;for(let c=0;c<a;c++)for(let e=0;e<a;e++){const g=b(c,e);if(void 0!==g)return g}return 0},I=a=>{const b=a[0].length-1,c=a.length-1,e=w(a,(h,k)=>{if(a[k][h])return-h}),g=w(a,(h,k)=>{if(a[h][k])return-h}),f=w(a,(h,k)=>{if(a[k][b-h])return-h}),d=w(a,
(h,k)=>{if(a[c-h][k])return-h});return[g,e,d,f]},J=(a,b,c,e)=>{const [g,f]=b;[b]=e;e=a.length;const [d,h,k,n]=c;c=e+n;e+=k;let q=1;for(let p=-d;p<e;p++)for(let l=-h;l<c;l++)if(a[p][l]){const r=p+f,t=l+g;if(void 0===b[r]||b[r][t]){q=0;break}}return q},R=(a,b)=>{const [c,e]=b;var g=c.length;const f=[];for(let d=0;d<g;d++){f[d]=[];for(let h=0;h<g;h++)f[d].push(c[g-h-1][d])}g=I(f);J(f,e,g,a)&&(b[0]=f,b[2]=g)},K=(a,b,c)=>{const [e,g,f,,d]=c;var h=e.length;const [k,n,q,p]=f;c=h+p;h+=q;const [l,r]=g;for(let t=
-k;t<h;t++)for(let u=-n;u<c;u++)e[t][u]&&(a[t+r][u+l]=b?0:d)},S=a=>a[3],W=(a,b,c,e)=>{const [g,f,d,h]=e;if(h)return e;const [k,n]=b;var [q]=c;const [p,l]=f;a=p+k;b=l+n;const r=q[0].length;q=q.length;const [t,u,T,U]=d;var A=g.length;const V=A+U;A+=T;c=J(g,[a,b],d,c);!c&&n&&(e[3]=1);c&&(f[B]=Math.max(a,u),f[C]=Math.max(b,t),f[B]=Math.min(f[B],r-V),f[C]=Math.min(f[C],q-A))},B=0,C=1,X=a=>a[4],L=(a,b)=>{const [c,,e]=b;b=[];for(let g of e)g&&(g(m([c,1],K)),b.push(g(a)),g(m([c,0],K)));return b},Y=a=>{L(m([a],
R),a)},x=(a,b,c)=>{L(m([a,b,c],W),c)},Z=(a,b)=>{const [c]=b,[e,g]=b[4],f=[];for(var d=0;d<c.length;d++){let h=0;for(let k=0;k<c[d].length;k++)h+=c[d][k]?1:0;h==c[d].length&&f.push(d);if(!d&&h)return e(m([1],z)),a.clearTimeout(b[3]),0}for(const h of f)for(b[5]+=1,g(m([b[5]],z)),a=h;0<a;a--)for(d=0;d<c[a].length;d++)c[a][d]=c[a-1][d];return f.length},M=(a,b)=>{const [,,c]=b;x(a,[0,1],b);b[3]=a.setTimeout(m([a,b],M),1E3-10*b[5]);for(let e=0;e<c.length;e++)if(c[e](S)){for(;Z(a,b););delete c[e];--c.length;
N(a,b)}},aa=(a,b,c)=>{const [e,g]=b;b=[];for(var f=0;f<g;f++){var d=(new a.Array(e)).fill(0);b.push(d)}f=F();d=F();c=[b,c,[],0,[f,d],0];M(a,c);return y(c)},N=(a,b)=>{const [c,,e]=b;[b]=b[4];b(m([0],z));if(!e.length){b=a.Math;var g=b.round;var f=H.length-1;f=a.Math.random()*(f-0);g=g.call(b,f);b=[a.Math.floor(c[0].length/2)-2,0];var [d,h]=H[g];g=d.length-d[0].length;if(0>g)for(f=0;f<Math.abs(g);f++){const k=(new a.Array(d[0].length)).fill(0);d.push(k)}else if(0<g)for(a=0;a<d.length;a++)for(f=0;f<g;f++)d[a].push(0);
a=I(d);a=y([d,b,a,0,h]);e.push(a)}},ba=(a,b)=>{const [c,e]=b,[g,f]=e;b=c.length;const d=c[0].length,h=b*f,k=d*g;a.clearRect(0,0,k,h);for(let n=0;n<b;n++){const q=f*n;a.fillRect(0,q-1,k,2);for(let p=0;p<d;p++){const l=g*p;n||a.fillRect(l-1,0,2,h);if(c[n][p]){const r=c[n][p];"string"==typeof r&&(a.fillStyle=r);a.fillRect(l+5,q+5,g-10,f-10);a.fillStyle="#000"}}}},O=(a,b,c)=>{b(m([c],ba));a.requestAnimationFrame(m([a,b,c],O))},ca=(a,b)=>{a={Space:m([a],N),KeyE:Y,KeyS:m([a,[0,1]],x),KeyA:m([a,[-1,0]],
x),KeyD:m([a,[1,0]],x)};for(let c in a)a[c]=m([a[c]],b);return a},da=[["Space","Start (space)"],["KeyE","Rotate (E)"],["KeyA","Left (A)"],["KeyS","Down (S)"],["KeyD","Right (D)"]],D={display:"inline-block",margin:"5px"},P={display:"block",margin:"5px auto"},v={padding:"5px",touchAction:"manipulation"},ea=a=>({Space:a.Object.assign({},v,P),KeyE:a.Object.assign({},v,P),KeyS:a.Object.assign({},D,v),KeyA:a.Object.assign({},D,v),KeyD:a.Object.assign({},D,v)}),fa=(a,b,c)=>{const e=a.document.createElement("div");
a.Object.assign(b.style,{marginBottom:"200px"});a.Object.assign(e.style,{position:"absolute",top:"100%",left:"0",right:"0"});const g=ea(a);da.forEach(([f,d])=>{const h=a.document.createElement("button");h.innerText=d;(d=g[f])&&a.Object.assign(h.style,d);h.addEventListener("click",c[f],{passive:!0});e.appendChild(h)});b.appendChild(e)},ha=(a,b)=>{b.innerHTML="";var c=[10,20];a.Object.assign(b.style,{height:"400px",width:"200px",backgroundColor:"white",margin:"40px auto 0"});const e=a.document.createElement("div");
a.Object.assign(e.style,{left:"0",right:"0",position:"absolute",top:"-30px"});e.innerText="Press SPACE to start";b.appendChild(e);const [g,f]=Q(a,b);var d=f.getContext("2d");if(d){var [h,k]=c;c=aa(a,c,[g.width/h,g.height/k]);var n=ca(a,c);fa(a,b,n);document.addEventListener("keydown",l=>{if(n[l.code])n[l.code]()});var [q,p]=c(X);q(E(l=>{0===l&&"Press SPACE to start"==e.innerText?e.innerText="":1===l&&(e.innerText="Game Over")},G));p(E(l=>{e.innerText=`Your score ${l}`},G));O(a,c,d)}};window.addEventListener("load",
()=>{var a=window;const b=document.querySelectorAll(".js-tetris");a.Array.from(b).forEach(m([a],ha))})})();
